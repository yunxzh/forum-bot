[supervisord]
nodaemon=true
user=root
logfile=/app/logs/supervisord.log
pidfile=/var/run/supervisord.pid
loglevel=info

[program:nginx]
command=/usr/sbin/nginx -g "daemon off;"
autostart=true
autorestart=true
stdout_logfile=/app/logs/nginx.log
stderr_logfile=/app/logs/nginx_error.log
priority=1

[program:backend]
command=python -u /app/backend/app.py
directory=/app
autostart=true
autorestart=true
stdout_logfile=/app/logs/backend.log
stderr_logfile=/app/logs/backend_error.log
environment=PYTHONUNBUFFERED="1",PYTHONPATH="/app"
priority=2

[program:scheduler]
command=python -u -m scheduler.scheduler_main
directory=/app
autostart=true
autorestart=true
stdout_logfile=/app/logs/scheduler.log
stderr_logfile=/app/logs/scheduler_error.log
environment=PYTHONUNBUFFERED="1",PYTHONPATH="/app"
priority=3
# 延迟启动，等待数据库初始化完成
startsecs=5
startretries=5
# 如果启动失败，不要让整个 supervisor 崩溃
autorestart=unexpected
exitcodes=0
